# Домашнее задание к занятию 1. «Типы и структура СУБД»

### Выполнил студент группы DevOps-25 Шаповалов Кирилл

> 01. Задача 1. Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определённых данных.

Условия:

```
- электронные чеки в json-виде;
- склады и автомобильные дороги для логистической компании;
- генеалогические деревья;
- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации;
- отношения клиент-покупка для интернет-магазина.
```

1. Электронные чеки в json-виде лучше хранить в документоориентированных БД. Как объяснял Сергей в лекции - наиболее для этого подойдет, например, MongoDB, так как она позволяет хранить набор совершенно разных по наполнению документов, никак не связанных между собой. Что идеально соответствует хранению чеков.
2. Для хранения данных о складах и автомобильных дорогах логистической компании подойдут графовые СУБД. Основными элекментами данных тут являются узлы (склады) и связи между ними (дороги логичстической компании). Так как графовые СУБД могут вычислять оптимальные маршруты - в данном случае они покажут наилучшую производительность.
3. Для генеалогического древа сами по себе напрашиваются иерархические СУБД. Именно они предназначены для представления данных в виде древовидной структуры с четкими связями между элементами данных.
4. Кэш идетификаторов лучше всего хранить в наиболее подходящих СУБД для этого - Redis или Memcached. За счет многопоточности в Memcached можно добиться лучшей производительности, а, значит, лучшей работы аутентификации в приложении.
5. Отношения Клиент-Покупка - я бы наверное определил в реляционных СУБД. Еще со школы мы строили такие модели с реляционными связями между таблицами по ключам. Если выбирать из конкретных продуктов - наверное я бы остановился на PostgreSQL.


> 02. Задача 2. Вы создали распределённое высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система в каждом из случаев?

<b>1. Данные записываются на все узлы с задержкой до часа (асинхронная запись).</b>

C данным пунктом все не однозначно, поскольку тут возможны варианты - во-первых, при потере сетевого соединения может получиться два кластера, не связанных друг с другом, а во-вторых, как в случае например с MS SQL - при потере соединения зеркальная база переходит в режим Disconnected и остается только для горячего резерва. В первом случае это будет:
<ul>
<li> по CAP-теореме - <b>AP-система</b>, так как в какой-то момент времени данные могут оказаться неконсистентны, но доступны и устойчивы к разделению, например нарушена связь между двумя серверными, в это время данные стали одновременно доступны пользователям в первой серверной и пользователям во второй, но между собой они станут неконсистентны;</li>
<li>по теореме PACELC это будет, во-первых, PA-система, потому что в случае разделения данные остаются доступны (асинхронная запись, в случае синхронной - данные были бы недоступны), во-вторых, скорей всего EL-система, то есть в режиме нормальной работы будет выбран приоритет низкой задержки, чем согласованности, опять же потому что происходит запись с задержкой до часа, таким образом это <b>PA/EL-система</b></li>
</ul>
А во втором случае это будет:
<ul>
<li>по CAP-теореме - <b>CP-система</b>, поскольку тот же SQL будет стараться сохранить данные консистентными и доступными, где-то в ущерб производительности;</li>
<li>по теореме PACELC - <b>PC/EL-система</b>, так как в случае разделения опять же данные будут консистентными, а в режиме нормальной работы приоритет будет у скорости ответа пользователю.</li>
</ul>


<b>2. При сетевых сбоях система может разделиться на 2 раздельных кластера.</b>

Тут все однозначно и как я и описал в пункте выше - это частный случай ситуации из первого пункта. Это будет AP-система по CAP теореме и PA/EL по PACELC.

<b>3. Система может не прислать корректный ответ или сбросить соединение.</b>
<ul>
<li>по CAP-теореме это <b>CP-система</b> - так как способна работать в ущерб доступности, не присылая ответ или сбрасывая соединение;</li>
<li>по PACELC-теореме это <b>PC/EC-система</b>, то есть такая система, которая не отказывается от согласованности, но платит за это задержками, сбросами соединений.</li>
</ul>


> 03. Задача 3. Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

Как сказано в лекции, BASE противопоставляет себя ACID. По принципам BASE строят высокопроизводительные системы, которые где-то могут работать в ущерб надежности. По принципам ACID строят высоконадежные системы, которые не будут работать в случае деградации узлов системы.

Таким образом, сочетаться данные принципы друг с другом не могут.

> 04. Задача 4. Вам дали задачу написать системное решение, основой которого бы послужили фиксация некоторых значений с временем жизни и реакция на истечение таймаута. Вы слышали о key-value-хранилище, которое имеет механизм Pub/Sub. Что это за система? Какие минусы выбора этой системы?

Так как MemCacheD не поддерживает механизм pub/sub, в данном случае остается один вариант - это система Redis.

Какие недостатки использования данной системы можно отметить:

1. Как было сказано в лекции - система однопоточна. То есть за один момент времени она способна обработать только один запрос. При большом количестве запросов будет скапливаться очередь ожидания, и тут мы переходим ко второму минусу, который одновременно и плюс конечно.
2. Данные хранятся в оперативной памяти. Это значит, что если у вас есть какие-то неполадки с питанием - вы будете терять данные, если у вас нет механизма записи на диск или если вы не используете Redis в совокупности с брокерами подключений, если я правильно понимаю логику работы данного решения.
3. Еще одним недостатком является семантика доставки Redis. Как сказано в официальном мануале - каждое сообщение пользователю будет отправлено только один раз. То есть если в это время произошел сбой у клиента, или пользователь просто отошел от ПК - сообщение будет потеряно. Никакого напоминания или повторной отправки самим Redis'ом не предусмотрено.
